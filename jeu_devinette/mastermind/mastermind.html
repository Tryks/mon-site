<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastermind Ultime</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4fc3f7;
            --background-color: #f5f7fa;
            --card-color: #ffffff;
            --text-color: #333333;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --error-color: #f44336;
            --border-radius: 12px;
            --box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--box-shadow);
            position: relative;
            z-index: 10;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .container {
            display: flex;
            flex: 1;
            padding: 1.5rem;
            gap: 1.5rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .game-area {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .sidebar {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            min-width: 300px;
        }

        .card {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 1.5rem;
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }

        .card-title {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 0.5rem;
        }

        .game-board {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .attempt-row {
            display: flex;
            gap: 0.8rem;
            align-items: center;
            padding: 0.8rem;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .attempt-row.active {
            background-color: var(--accent-color);
            transform: scale(1.02);
        }

        .peg {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .peg:hover {
            transform: scale(1.1);
            border-color: white;
        }

        .peg.empty {
            background-color: #e0e0e0;
            cursor: not-allowed;
        }

        .feedback {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-left: auto;
            width: 100px;
        }

        .feedback-peg {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: #cccccc;
        }

        .feedback-peg.correct {
            background-color: black;
        }

        .feedback-peg.partial {
            background-color: white;
            border: 1px solid black;
        }

        .color-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            margin-bottom: 1rem;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: var(--transition);
        }

        .color-option:hover {
            transform: scale(1.1);
            border-color: var(--text-color);
        }

        .color-option.selected {
            transform: scale(1.1);
            border-color: var(--accent-color);
            box-shadow: 0 0 10px var(--accent-color);
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background-color: #e0e0e0;
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background-color: #d0d0d0;
        }

        .btn-success {
            background-color: var(--success-color);
        }

        .btn-success:hover {
            background-color: #3d8b40;
        }

        .btn-danger {
            background-color: var(--error-color);
        }

        .btn-danger:hover {
            background-color: #d32f2f;
        }

        .btn-group {
            display: flex;
            gap: 0.8rem;
        }

        .settings-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        label {
            font-weight: 600;
            color: var(--secondary-color);
        }

        select, input {
            padding: 0.8rem;
            border-radius: var(--border-radius);
            border: 1px solid #ddd;
            font-size: 1rem;
            transition: var(--transition);
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(79, 195, 247, 0.3);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            background-color: rgba(79, 195, 247, 0.1);
            border-radius: var(--border-radius);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-color);
            opacity: 0.8;
        }

        .timer {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin: 1rem 0;
            color: var(--secondary-color);
        }

        .history-list {
            max-height: 200px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .history-item {
            padding: 0.5rem;
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            pointer-events: all;
        }

        .modal-content {
            background-color: var(--card-color);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            transform: translateY(-20px);
            transition: var(--transition);
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-color);
            opacity: 0.5;
            transition: var(--transition);
        }

        .close-btn:hover {
            opacity: 1;
            color: var(--error-color);
        }

        .secret-code {
            display: flex;
            gap: 0.8rem;
            justify-content: center;
            margin: 1.5rem 0;
        }

        .secret-peg {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .how-to-play ol {
            padding-left: 1.5rem;
            margin-top: 1rem;
        }

        .how-to-play li {
            margin-bottom: 0.8rem;
            line-height: 1.5;
        }

        .difficulty-badge {
            display: inline-block;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 0.5rem;
        }

        .beginner {
            background-color: #4caf50;
            color: white;
        }

        .intermediate {
            background-color: #ff9800;
            color: white;
        }

        .expert {
            background-color: #f44336;
            color: white;
        }

        .custom {
            background-color: #9c27b0;
            color: white;
        }

        @media (max-width: 900px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                min-width: auto;
            }
            
            .peg {
                width: 40px;
                height: 40px;
                font-size: 0.8rem;
            }
            
            .feedback {
                width: 80px;
            }
            
            .feedback-peg {
                width: 15px;
                height: 15px;
            }
        }

        @media (max-width: 600px) {
            .attempt-row {
                flex-wrap: wrap;
            }
            
            .feedback {
                margin-left: 0;
                margin-top: 0.5rem;
                justify-content: center;
                width: 100%;
            }
            
            .peg {
                width: 35px;
                height: 35px;
            }
            
            h1 {
                font-size: 2rem;
            }
        }

        /* Animation classes */
        .shake {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .bounce {
            animation: bounce 0.5s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .pulse {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Confetti effect */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            opacity: 0;
            z-index: 999;
            animation: confetti 5s ease-in-out;
        }

        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(1000px) rotate(720deg); opacity: 0; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Mastermind Ultime</h1>
        <p class="subtitle">Décoder la combinaison secrète</p>
    </header>

    <div class="container">
        <main class="game-area">
            <div class="card">
                <h2 class="card-title">Plateau de jeu</h2>
                <div class="game-board" id="gameBoard">
                    <!-- Les rangées de tentatives seront ajoutées dynamiquement ici -->
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">Palette de couleurs</h2>
                <div class="color-palette" id="colorPalette">
                    <!-- Les options de couleur seront ajoutées dynamiquement ici -->
                </div>
                <div class="btn-group">
                    <button class="btn btn-success" id="checkBtn">Vérifier</button>
                    <button class="btn btn-secondary" id="clearBtn">Effacer</button>
                    <button class="btn btn-danger" id="newGameBtn">Nouvelle partie</button>
                </div>
            </div>
        </main>

        <aside class="sidebar">
            <div class="card">
                <h2 class="card-title">Paramètres <span class="difficulty-badge beginner" id="difficultyBadge">Débutant</span></h2>
                <div class="settings-form">
                    <div class="form-group">
                        <label for="difficulty">Difficulté :</label>
                        <select id="difficulty" class="form-control">
                            <option value="easy">Facile (4 couleurs, 10 essais)</option>
                            <option value="medium" selected>Moyen (6 couleurs, 10 essais)</option>
                            <option value="hard">Difficile (8 couleurs, 8 essais)</option>
                            <option value="custom">Personnalisé</option>
                        </select>
                    </div>

                    <div class="custom-settings" id="customSettings" style="display: none;">
                        <div class="form-group">
                            <label for="codeLength">Longueur du code :</label>
                            <input type="number" id="codeLength" min="3" max="8" value="4" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="colorsCount">Nombre de couleurs :</label>
                            <input type="number" id="colorsCount" min="4" max="10" value="6" class="form-control">
                        </div>
                        <div class="form-group">
                            <label for="maxAttempts">Nombre maximum d'essais :</label>
                            <input type="number" id="maxAttempts" min="5" max="15" value="10" class="form-control">
                        </div>
                    </div>

                    <button class="btn" id="applySettingsBtn">Appliquer les paramètres</button>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">Statistiques</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="gamesPlayed">0</div>
                        <div class="stat-label">Parties jouées</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="gamesWon">0</div>
                        <div class="stat-label">Parties gagnées</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="winRate">0%</div>
                        <div class="stat-label">Taux de victoire</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="bestScore">-</div>
                        <div class="stat-label">Meilleur score</div>
                    </div>
                </div>
                <div class="timer" id="timer">00:00</div>
            </div>

            <div class="card">
                <h2 class="card-title">Historique</h2>
                <div class="history-list" id="historyList">
                    <!-- L'historique sera ajouté dynamiquement ici -->
                </div>
            </div>

            <div class="btn-group">
                <button class="btn btn-secondary" id="howToPlayBtn">Comment jouer</button>
                <button class="btn btn-secondary" id="aboutBtn">À propos</button>
            </div>
        </aside>
    </div>

    <!-- Modals -->
    <div class="modal" id="howToPlayModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Comment jouer à Mastermind</h3>
                <button class="close-btn" id="closeHowToPlay">&times;</button>
            </div>
            <div class="how-to-play">
                <p>Mastermind est un jeu de réflexion où vous devez deviner une combinaison secrète de couleurs.</p>
                <ol>
                    <li>Le jeu génère une combinaison secrète de couleurs (les mêmes couleurs peuvent être répétées).</li>
                    <li>À chaque tour, vous proposez une combinaison en cliquant sur les pastilles vides.</li>
                    <li>Après chaque tentative, vous recevez un feedback :
                        <ul>
                            <li>Un point noir pour chaque couleur correcte à la bonne position</li>
                            <li>Un point blanc pour chaque couleur correcte mais à la mauvaise position</li>
                        </ul>
                    </li>
                    <li>Utilisez ces indices pour déduire la combinaison secrète.</li>
                    <li>Vous gagnez si vous trouvez la combinaison avant d'épuiser tous vos essais.</li>
                </ol>
                <p>Bon jeu !</p>
            </div>
        </div>
    </div>

    <div class="modal" id="aboutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">À propos de Mastermind Ultime</h3>
                <button class="close-btn" id="closeAbout">&times;</button>
            </div>
            <p>Mastermind Ultime est une version améliorée du jeu classique Mastermind avec des fonctionnalités supplémentaires :</p>
            <ul>
                <li>Plusieurs niveaux de difficulté</li>
                <li>Paramètres personnalisables</li>
                <li>Suivi des statistiques</li>
                <li>Historique des parties</li>
                <li>Minuteur</li>
                <li>Interface moderne et intuitive</li>
            </ul>
            <p>Développé avec ❤️ pour les amateurs de jeux de réflexion.</p>
            <p>Version 1.0.0</p>
        </div>
    </div>

    <div class="modal" id="winModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Félicitations !</h3>
                <button class="close-btn" id="closeWin">&times;</button>
            </div>
            <p>Vous avez trouvé la combinaison secrète !</p>
            <div class="secret-code" id="winSecretCode">
                <!-- La combinaison secrète sera affichée ici -->
            </div>
            <p>Temps écoulé : <span id="winTime"></span></p>
            <p>Nombre d'essais : <span id="winAttempts"></span></p>
            <div class="btn-group" style="justify-content: center; margin-top: 1.5rem;">
                <button class="btn btn-success" id="playAgainBtn">Jouer à nouveau</button>
            </div>
        </div>
    </div>

    <div class="modal" id="loseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Partie terminée</h3>
                <button class="close-btn" id="closeLose">&times;</button>
            </div>
            <p>Vous n'avez pas trouvé la combinaison secrète.</p>
            <p>La combinaison était :</p>
            <div class="secret-code" id="loseSecretCode">
                <!-- La combinaison secrète sera affichée ici -->
            </div>
            <div class="btn-group" style="justify-content: center; margin-top: 1.5rem;">
                <button class="btn btn-success" id="tryAgainBtn">Essayer à nouveau</button>
            </div>
        </div>
    </div>

    <script>
        // Game state
        const gameState = {
            codeLength: 4,
            colorsCount: 6,
            maxAttempts: 10,
            currentAttempt: 0,
            secretCode: [],
            gameActive: false,
            selectedColor: null,
            startTime: null,
            timerInterval: null,
            stats: {
                gamesPlayed: 0,
                gamesWon: 0,
                bestScore: null
            },
            history: []
        };

        // Color palette (can be extended)
        const colors = [
            '#FF5252', // Rouge
            '#FF4081', // Rose
            '#E040FB', // Violet
            '#7C4DFF', // Violet foncé
            '#536DFE', // Bleu
            '#448AFF', // Bleu clair
            '#40C4FF', // Cyan
            '#18FFFF', // Cyan clair
            '#64FFDA', // Turquoise
            '#69F0AE', // Vert clair
            '#B2FF59', // Vert lime
            '#EEFF41', // Jaune
            '#FFFF00', // Jaune vif
            '#FFD740', // Orange
            '#FFAB40', // Orange foncé
            '#FF6E40'  // Rouge-orange
        ];

        // DOM elements
        const gameBoard = document.getElementById('gameBoard');
        const colorPalette = document.getElementById('colorPalette');
        const checkBtn = document.getElementById('checkBtn');
        const clearBtn = document.getElementById('clearBtn');
        const newGameBtn = document.getElementById('newGameBtn');
        const difficultySelect = document.getElementById('difficulty');
        const customSettings = document.getElementById('customSettings');
        const codeLengthInput = document.getElementById('codeLength');
        const colorsCountInput = document.getElementById('colorsCount');
        const maxAttemptsInput = document.getElementById('maxAttempts');
        const applySettingsBtn = document.getElementById('applySettingsBtn');
        const gamesPlayedEl = document.getElementById('gamesPlayed');
        const gamesWonEl = document.getElementById('gamesWon');
        const winRateEl = document.getElementById('winRate');
        const bestScoreEl = document.getElementById('bestScore');
        const timerEl = document.getElementById('timer');
        const historyList = document.getElementById('historyList');
        const difficultyBadge = document.getElementById('difficultyBadge');
        
        // Modals
        const howToPlayModal = document.getElementById('howToPlayModal');
        const aboutModal = document.getElementById('aboutModal');
        const winModal = document.getElementById('winModal');
        const loseModal = document.getElementById('loseModal');
        const howToPlayBtn = document.getElementById('howToPlayBtn');
        const aboutBtn = document.getElementById('aboutBtn');
        const closeHowToPlay = document.getElementById('closeHowToPlay');
        const closeAbout = document.getElementById('closeAbout');
        const closeWin = document.getElementById('closeWin');
        const closeLose = document.getElementById('closeLose');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const tryAgainBtn = document.getElementById('tryAgainBtn');
        const winSecretCode = document.getElementById('winSecretCode');
        const loseSecretCode = document.getElementById('loseSecretCode');
        const winTime = document.getElementById('winTime');
        const winAttempts = document.getElementById('winAttempts');

        // Initialize the game
        function initGame() {
            loadStats();
            setupEventListeners();
            renderColorPalette();
            updateStatsDisplay();
            startNewGame();
        }

        // Load stats from localStorage
        function loadStats() {
            const savedStats = localStorage.getItem('mastermindStats');
            if (savedStats) {
                gameState.stats = JSON.parse(savedStats);
            }
            
            const savedHistory = localStorage.getItem('mastermindHistory');
            if (savedHistory) {
                gameState.history = JSON.parse(savedHistory);
                renderHistory();
            }
        }

        // Save stats to localStorage
        function saveStats() {
            localStorage.setItem('mastermindStats', JSON.stringify(gameState.stats));
            localStorage.setItem('mastermindHistory', JSON.stringify(gameState.history));
        }

        // Set up event listeners
        function setupEventListeners() {
            // Game controls
            checkBtn.addEventListener('click', checkAttempt);
            clearBtn.addEventListener('click', clearCurrentAttempt);
            newGameBtn.addEventListener('click', startNewGame);
            
            // Settings
            difficultySelect.addEventListener('change', handleDifficultyChange);
            applySettingsBtn.addEventListener('click', applySettings);
            
            // Modals
            howToPlayBtn.addEventListener('click', () => toggleModal(howToPlayModal));
            aboutBtn.addEventListener('click', () => toggleModal(aboutModal));
            closeHowToPlay.addEventListener('click', () => toggleModal(howToPlayModal));
            closeAbout.addEventListener('click', () => toggleModal(aboutModal));
            closeWin.addEventListener('click', () => toggleModal(winModal));
            closeLose.addEventListener('click', () => toggleModal(loseModal));
            playAgainBtn.addEventListener('click', () => {
                toggleModal(winModal);
                startNewGame();
            });
            tryAgainBtn.addEventListener('click', () => {
                toggleModal(loseModal);
                startNewGame();
            });
        }

        // Toggle modal visibility
        function toggleModal(modal) {
            modal.classList.toggle('active');
        }

        // Handle difficulty selection change
        function handleDifficultyChange() {
            const difficulty = difficultySelect.value;
            
            switch (difficulty) {
                case 'easy':
                    gameState.codeLength = 4;
                    gameState.colorsCount = 4;
                    gameState.maxAttempts = 10;
                    customSettings.style.display = 'none';
                    difficultyBadge.textContent = 'Débutant';
                    difficultyBadge.className = 'difficulty-badge beginner';
                    break;
                case 'medium':
                    gameState.codeLength = 4;
                    gameState.colorsCount = 6;
                    gameState.maxAttempts = 10;
                    customSettings.style.display = 'none';
                    difficultyBadge.textContent = 'Intermédiaire';
                    difficultyBadge.className = 'difficulty-badge intermediate';
                    break;
                case 'hard':
                    gameState.codeLength = 5;
                    gameState.colorsCount = 8;
                    gameState.maxAttempts = 8;
                    customSettings.style.display = 'none';
                    difficultyBadge.textContent = 'Expert';
                    difficultyBadge.className = 'difficulty-badge expert';
                    break;
                case 'custom':
                    customSettings.style.display = 'block';
                    difficultyBadge.textContent = 'Personnalisé';
                    difficultyBadge.className = 'difficulty-badge custom';
                    // Set inputs to current values
                    codeLengthInput.value = gameState.codeLength;
                    colorsCountInput.value = gameState.colorsCount;
                    maxAttemptsInput.value = gameState.maxAttempts;
                    break;
            }
        }

        // Apply settings from the form
        function applySettings() {
            const difficulty = difficultySelect.value;
            
            if (difficulty === 'custom') {
                gameState.codeLength = parseInt(codeLengthInput.value);
                gameState.colorsCount = parseInt(colorsCountInput.value);
                gameState.maxAttempts = parseInt(maxAttemptsInput.value);
                
                // Validate inputs
                if (gameState.codeLength < 3 || gameState.codeLength > 8) {
                    alert('La longueur du code doit être entre 3 et 8');
                    return;
                }
                
                if (gameState.colorsCount < 4 || gameState.colorsCount > 16) {
                    alert('Le nombre de couleurs doit être entre 4 et 16');
                    return;
                }
                
                if (gameState.maxAttempts < 5 || gameState.maxAttempts > 15) {
                    alert('Le nombre maximum d\'essais doit être entre 5 et 15');
                    return;
                }
            }
            
            startNewGame();
        }

        // Start a new game
        function startNewGame() {
            // Stop any running timer
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            // Reset game state
            gameState.currentAttempt = 0;
            gameState.gameActive = true;
            gameState.secretCode = generateSecretCode();
            gameState.startTime = new Date();
            
            // Start timer
            gameState.timerInterval = setInterval(updateTimer, 1000);
            updateTimer();
            
            // Render game board
            renderGameBoard();
            
            // Update UI
            checkBtn.disabled = false;
            clearBtn.disabled = false;
            
            console.log('Secret code:', gameState.secretCode); // For debugging (remove in production)
        }

        // Generate a secret code
        function generateSecretCode() {
            const code = [];
            const availableColors = colors.slice(0, gameState.colorsCount);
            
            for (let i = 0; i < gameState.codeLength; i++) {
                const randomIndex = Math.floor(Math.random() * availableColors.length);
                code.push(availableColors[randomIndex]);
            }
            
            return code;
        }

        // Render the game board
        function renderGameBoard() {
            gameBoard.innerHTML = '';
            
            for (let i = 0; i < gameState.maxAttempts; i++) {
                const attemptRow = document.createElement('div');
                attemptRow.className = 'attempt-row';
                if (i === 0) attemptRow.classList.add('active');
                attemptRow.dataset.attempt = i;
                
                for (let j = 0; j < gameState.codeLength; j++) {
                    const peg = document.createElement('div');
                    peg.className = 'peg empty';
                    peg.dataset.position = j;
                    peg.addEventListener('click', () => handlePegClick(peg, i));
                    attemptRow.appendChild(peg);
                }
                
                const feedback = document.createElement('div');
                feedback.className = 'feedback';
                attemptRow.appendChild(feedback);
                
                gameBoard.appendChild(attemptRow);
            }
        }

        // Render the color palette
        function renderColorPalette() {
            colorPalette.innerHTML = '';
            const availableColors = colors.slice(0, gameState.colorsCount);
            
            availableColors.forEach((color, index) => {
                const colorOption = document.createElement('div');
                colorOption.className = 'color-option';
                colorOption.style.backgroundColor = color;
                colorOption.dataset.color = color;
                colorOption.addEventListener('click', () => selectColor(colorOption));
                colorPalette.appendChild(colorOption);
            });
        }

        // Handle peg click
        function handlePegClick(peg, attemptIndex) {
            if (!gameState.gameActive || attemptIndex !== gameState.currentAttempt || !gameState.selectedColor) return;
            
            peg.style.backgroundColor = gameState.selectedColor;
            peg.classList.remove('empty');
            peg.dataset.color = gameState.selectedColor;
        }

        // Select a color from the palette
        function selectColor(colorOption) {
            // Remove selection from all colors
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
            });
            
            // Select the clicked color
            colorOption.classList.add('selected');
            gameState.selectedColor = colorOption.dataset.color;
        }

        // Check the current attempt
        function checkAttempt() {
            if (!gameState.gameActive) return;
            
            const currentRow = document.querySelector(`.attempt-row[data-attempt="${gameState.currentAttempt}"]`);
            const pegs = currentRow.querySelectorAll('.peg:not(.empty)');
            
            // Check if all pegs are filled
            if (pegs.length < gameState.codeLength) {
                currentRow.classList.add('shake');
                setTimeout(() => {
                    currentRow.classList.remove('shake');
                }, 500);
                return;
            }
            
            // Get the attempt
            const attempt = [];
            currentRow.querySelectorAll('.peg').forEach(peg => {
                attempt.push(peg.dataset.color || 'empty');
            });
            
            // Check for correct positions
            let correctPositions = 0;
            const secretCodeCopy = [...gameState.secretCode];
            const attemptCopy = [...attempt];
            
            // First pass - check correct positions
            for (let i = 0; i < gameState.codeLength; i++) {
                if (attemptCopy[i] === secretCodeCopy[i]) {
                    correctPositions++;
                    secretCodeCopy[i] = null; // Mark as counted
                    attemptCopy[i] = null; // Mark as counted
                }
            }
            
            // Second pass - check correct colors in wrong positions
            let correctColors = 0;
            for (let i = 0; i < gameState.codeLength; i++) {
                if (attemptCopy[i] === null) continue; // Already counted as correct position
                
                const index = secretCodeCopy.indexOf(attemptCopy[i]);
                if (index !== -1) {
                    correctColors++;
                    secretCodeCopy[index] = null; // Mark as counted
                }
            }
            
            // Render feedback
            const feedback = currentRow.querySelector('.feedback');
            feedback.innerHTML = '';
            
            for (let i = 0; i < correctPositions; i++) {
                const feedbackPeg = document.createElement('div');
                feedbackPeg.className = 'feedback-peg correct';
                feedback.appendChild(feedbackPeg);
            }
            
            for (let i = 0; i < correctColors; i++) {
                const feedbackPeg = document.createElement('div');
                feedbackPeg.className = 'feedback-peg partial';
                feedback.appendChild(feedbackPeg);
            }
            
            // Check for win
            if (correctPositions === gameState.codeLength) {
                gameWon();
                return;
            }
            
            // Move to next attempt
            gameState.currentAttempt++;
            
            // Check for game over
            if (gameState.currentAttempt >= gameState.maxAttempts) {
                gameLost();
                return;
            }
            
            // Update active row
            document.querySelectorAll('.attempt-row').forEach(row => {
                row.classList.remove('active');
            });
            document.querySelector(`.attempt-row[data-attempt="${gameState.currentAttempt}"]`).classList.add('active');
        }

        // Clear current attempt
        function clearCurrentAttempt() {
            if (!gameState.gameActive) return;
            
            const currentRow = document.querySelector(`.attempt-row[data-attempt="${gameState.currentAttempt}"]`);
            currentRow.querySelectorAll('.peg').forEach(peg => {
                peg.style.backgroundColor = '';
                peg.classList.add('empty');
                peg.dataset.color = '';
            });
        }

        // Game won
        function gameWon() {
            endGame(true);
            showWinModal();
            createConfetti();
        }

        // Game lost
        function gameLost() {
            endGame(false);
            showLoseModal();
        }

        // End the game
        function endGame(isWin) {
            gameState.gameActive = false;
            clearInterval(gameState.timerInterval);
            
            // Update stats
            gameState.stats.gamesPlayed++;
            
            if (isWin) {
                gameState.stats.gamesWon++;
                
                const timeElapsed = Math.floor((new Date() - gameState.startTime) / 1000);
                const attemptsUsed = gameState.currentAttempt + 1;
                
                if (!gameState.stats.bestScore || attemptsUsed < gameState.stats.bestScore) {
                    gameState.stats.bestScore = attemptsUsed;
                }
                
                // Add to history
                gameState.history.unshift({
                    result: 'win',
                    attempts: attemptsUsed,
                    time: timeElapsed,
                    date: new Date().toLocaleString(),
                    difficulty: difficultySelect.options[difficultySelect.selectedIndex].text
                });
                
                // Keep only last 10 games in history
                if (gameState.history.length > 10) {
                    gameState.history = gameState.history.slice(0, 10);
                }
            } else {
                // Add to history
                gameState.history.unshift({
                    result: 'lose',
                    attempts: gameState.maxAttempts,
                    time: Math.floor((new Date() - gameState.startTime) / 1000),
                    date: new Date().toLocaleString(),
                    difficulty: difficultySelect.options[difficultySelect.selectedIndex].text
                });
                
                // Keep only last 10 games in history
                if (gameState.history.length > 10) {
                    gameState.history = gameState.history.slice(0, 10);
                }
            }
            
            // Save stats and update display
            saveStats();
            updateStatsDisplay();
            renderHistory();
            
            // Disable buttons
            checkBtn.disabled = true;
            clearBtn.disabled = true;
        }

        // Show win modal
        function showWinModal() {
            winSecretCode.innerHTML = '';
            gameState.secretCode.forEach(color => {
                const peg = document.createElement('div');
                peg.className = 'secret-peg';
                peg.style.backgroundColor = color;
                winSecretCode.appendChild(peg);
            });
            
            const timeElapsed = Math.floor((new Date() - gameState.startTime) / 1000);
            const minutes = Math.floor(timeElapsed / 60);
            const seconds = timeElapsed % 60;
            winTime.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            winAttempts.textContent = gameState.currentAttempt + 1;
            
            toggleModal(winModal);
        }

        // Show lose modal
        function showLoseModal() {
            loseSecretCode.innerHTML = '';
            gameState.secretCode.forEach(color => {
                const peg = document.createElement('div');
                peg.className = 'secret-peg';
                peg.style.backgroundColor = color;
                loseSecretCode.appendChild(peg);
            });
            
            toggleModal(loseModal);
        }

        // Update timer display
        function updateTimer() {
            if (!gameState.startTime) return;
            
            const now = new Date();
            const elapsed = Math.floor((now - gameState.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            
            timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Update stats display
        function updateStatsDisplay() {
            gamesPlayedEl.textContent = gameState.stats.gamesPlayed;
            gamesWonEl.textContent = gameState.stats.gamesWon;
            
            const winRate = gameState.stats.gamesPlayed > 0 
                ? Math.round((gameState.stats.gamesWon / gameState.stats.gamesPlayed) * 100)
                : 0;
            winRateEl.textContent = `${winRate}%`;
            
            bestScoreEl.textContent = gameState.stats.bestScore !== null ? gameState.stats.bestScore : '-';
        }

        // Render history
        function renderHistory() {
            historyList.innerHTML = '';
            
            gameState.history.forEach(game => {
                const item = document.createElement('div');
                item.className = 'history-item';
                
                const resultIcon = game.result === 'win' ? '🏆' : '❌';
                const timeFormatted = `${Math.floor(game.time / 60)}m ${game.time % 60}s`;
                
                item.innerHTML = `
                    <strong>${resultIcon} ${game.difficulty.split(' ')[0]}</strong> - 
                    ${game.attempts} essais - 
                    ${timeFormatted} - 
                    <small>${game.date}</small>
                `;
                
                historyList.appendChild(item);
            });
        }

        // Create confetti effect
        function createConfetti() {
            const colors = ['#ff0000', '#00ff00', '#0000ff', '#ffff00', '#ff00ff', '#00ffff'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 5 + 's';
                document.body.appendChild(confetti);
                
                // Remove after animation
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        // Initialize the game when the page loads
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>