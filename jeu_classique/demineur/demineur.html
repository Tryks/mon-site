<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√©mineur Premium</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --text-color: #2c3e50;
            --background-color: #ecf0f1;
            --cell-size: 40px;
            --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: all 0.5s ease;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-image: var(--bg-pattern);
            background-size: cover;
            background-attachment: fixed;
        }

        /* Th√®mes */
        .theme-classic {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --text-color: #2c3e50;
            --background-color: #ecf0f1;
            --bg-pattern: none;
            --cell-revealed: #bdc3c7;
            --cell-hidden: #95a5a6;
            --mine-color: #e74c3c;
            --flag-color: #f1c40f;
            --number-1: #2ecc71;
            --number-2: #e67e22;
            --number-3: #e74c3c;
            --number-4: #9b59b6;
            --number-5: #1abc9c;
            --number-6: #d35400;
            --number-7: #34495e;
            --number-8: #7f8c8d;
        }

        .theme-dark {
            --primary-color: #8e44ad;
            --secondary-color: #9b59b6;
            --text-color: #ecf0f1;
            --background-color: #2c3e50;
            --bg-pattern: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7));
            --cell-revealed: #34495e;
            --cell-hidden: #2c3e50;
            --mine-color: #c0392b;
            --flag-color: #f39c12;
            --number-1: #27ae60;
            --number-2: #d35400;
            --number-3: #c0392b;
            --number-4: #8e44ad;
            --number-5: #16a085;
            --number-6: #e67e22;
            --number-7: #bdc3c7;
            --number-8: #95a5a6;
        }

        .theme-nature {
            --primary-color: #27ae60;
            --secondary-color: #2ecc71;
            --text-color: #34495e;
            --background-color: #d5f5e3;
            --bg-pattern: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect fill="%23d5f5e3" width="100" height="100"/><path fill="%23a3e4d7" d="M30,10L50,30L70,10L90,30L70,50L90,70L70,90L50,70L30,90L10,70L30,50L10,30L30,10Z"/></svg>');
            --cell-revealed: #a3e4d7;
            --cell-hidden: #82e0aa;
            --mine-color: #e74c3c;
            --flag-color: #f4d03f;
            --number-1: #2980b9;
            --number-2: #8e44ad;
            --number-3: #c0392b;
            --number-4: #f39c12;
            --number-5: #16a085;
            --number-6: #d35400;
            --number-7: #7f8c8d;
            --number-8: #2c3e50;
        }

        .theme-ocean {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --text-color: #ecf0f1;
            --background-color: #1a5276;
            --bg-pattern: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect fill="%231a5276" width="100" height="100"/><path fill="%232980b9" d="M0,50Q25,40 50,50T100,50Q75,60 50,50T0,50Z" opacity="0.3"/></svg>');
            --cell-revealed: #2980b9;
            --cell-hidden: #1a5276;
            --mine-color: #e74c3c;
            --flag-color: #f1c40f;
            --number-1: #2ecc71;
            --number-2: #e67e22;
            --number-3: #e74c3c;
            --number-4: #9b59b6;
            --number-5: #1abc9c;
            --number-6: #d35400;
            --number-7: #bdc3c7;
            --number-8: #95a5a6;
        }

        .theme-space {
            --primary-color: #9b59b6;
            --secondary-color: #8e44ad;
            --text-color: #ecf0f1;
            --background-color: #2c3e50;
            --bg-pattern: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect fill="%232c3e50" width="100" height="100"/><circle cx="20" cy="30" r="1" fill="white"/><circle cx="50" cy="15" r="1" fill="white"/><circle cx="80" cy="25" r="1" fill="white"/><circle cx="30" cy="70" r="1" fill="white"/><circle cx="60" cy="80" r="1" fill="white"/><circle cx="90" cy="60" r="1" fill="white"/></svg>');
            --cell-revealed: #34495e;
            --cell-hidden: #2c3e50;
            --mine-color: #e74c3c;
            --flag-color: #f39c12;
            --number-1: #3498db;
            --number-2: #2ecc71;
            --number-3: #f1c40f;
            --number-4: #e67e22;
            --number-5: #1abc9c;
            --number-6: #d35400;
            --number-7: #bdc3c7;
            --number-8: #95a5a6;
        }

        .header {
            width: 100%;
            background-color: var(--primary-color);
            color: white;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 10;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        .game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            width: 100%;
            max-width: 1200px;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 10px;
            border-radius: 8px;
            backdrop-filter: blur(5px);
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            justify-content: center;
            width: 100%;
        }

        .stat {
            background-color: var(--secondary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 1.2em;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            min-width: 120px;
            text-align: center;
        }

        .board-container {
            position: relative;
            margin-bottom: 20px;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(var(--cols), var(--cell-size));
            grid-template-rows: repeat(var(--rows), var(--cell-size));
            gap: 2px;
            background-color: var(--secondary-color);
            padding: 5px;
            border-radius: 8px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            position: relative;
            overflow: hidden;
        }

        .cell {
            width: 100%;
            height: 100%;
            background-color: var(--cell-hidden);
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s ease;
            border-radius: 3px;
            position: relative;
            overflow: hidden;
        }

        .cell:hover {
            filter: brightness(1.1);
            transform: scale(1.05);
        }

        .cell.revealed {
            background-color: var(--cell-revealed);
            transform: scale(1);
        }

        .cell.mine {
            background-color: var(--mine-color);
        }

        .cell.flagged {
            background-color: var(--flag-color);
        }

        .cell.flagged::before {
            content: "üö©";
            font-size: calc(var(--cell-size) * 0.7);
        }

        .cell.mine.revealed::before {
            content: "üí£";
            font-size: calc(var(--cell-size) * 0.7);
        }

        .cell.mine.exploded {
            animation: explode 0.5s ease-out;
            background-color: #ff0000;
        }

        @keyframes explode {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        .cell.number-1 { color: var(--number-1); }
        .cell.number-2 { color: var(--number-2); }
        .cell.number-3 { color: var(--number-3); }
        .cell.number-4 { color: var(--number-4); }
        .cell.number-5 { color: var(--number-5); }
        .cell.number-6 { color: var(--number-6); }
        .cell.number-7 { color: var(--number-7); }
        .cell.number-8 { color: var(--number-8); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 100;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: var(--background-color);
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            animation: modalFadeIn 0.3s ease-out;
            position: relative;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal h2 {
            margin-top: 0;
            color: var(--primary-color);
        }

        .modal button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin-top: 20px;
            transition: all 0.2s ease;
        }

        .modal button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            border-radius: 50%;
            animation: fall 5s linear forwards;
        }

        @keyframes fall {
            to { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .theme-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .theme-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .theme-option:hover {
            transform: scale(1.1);
        }

        .theme-option.active {
            border-color: var(--text-color);
            transform: scale(1.1);
        }

        .theme-classic-option { background: linear-gradient(135deg, #3498db, #ecf0f1); }
        .theme-dark-option { background: linear-gradient(135deg, #8e44ad, #2c3e50); }
        .theme-nature-option { background: linear-gradient(135deg, #27ae60, #d5f5e3); }
        .theme-ocean-option { background: linear-gradient(135deg, #3498db, #1a5276); }
        .theme-space-option { background: linear-gradient(135deg, #9b59b6, #2c3e50); }

        .difficulty-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .difficulty-option {
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            background-color: var(--secondary-color);
            color: white;
            transition: all 0.2s ease;
            font-weight: bold;
        }

        .difficulty-option:hover {
            transform: scale(1.05);
        }

        .difficulty-option.active {
            background-color: var(--primary-color);
            transform: scale(1.05);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
        }

        .custom-settings {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .custom-settings input {
            width: 60px;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid var(--secondary-color);
            text-align: center;
        }

        .settings-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.2s ease;
        }

        .settings-button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
        }

        .sound-toggle {
            position: relative;
            width: 50px;
            height: 24px;
        }

        .sound-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .animation-toggle {
            margin-left: 10px;
        }

        .tutorial {
            background-color: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            backdrop-filter: blur(5px);
            max-width: 800px;
        }

        .tutorial h3 {
            color: var(--primary-color);
            margin-top: 0;
        }

        .tutorial ol {
            padding-left: 20px;
        }

        .tutorial li {
            margin-bottom: 10px;
        }

        .footer {
            margin-top: auto;
            padding: 20px;
            text-align: center;
            color: var(--text-color);
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            :root {
                --cell-size: 30px;
            }

            .controls {
                flex-direction: column;
                align-items: center;
            }

            .stats {
                flex-direction: column;
                align-items: center;
            }

            .stat {
                width: 100%;
                max-width: 200px;
            }
        }

        /* Effets sp√©ciaux */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background-color: rgba(255, 255, 255, 0.4);
            transform: scale(0);
            animation: ripple 0.6s linear;
            pointer-events: none;
        }

        @keyframes ripple {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }

        .pulse {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translateX(-1px); }
            20%, 80% { transform: translateX(2px); }
            30%, 50%, 70% { transform: translateX(-4px); }
            40%, 60% { transform: translateX(4px); }
        }
    </style>
</head>
<body class="theme-classic">
    <div class="header">
        <h1>D√©mineur Premium</h1>
    </div>

    <div class="game-container">
        <div class="controls">
            <div class="control-group">
                <button id="new-game-btn" class="settings-button">Nouvelle partie</button>
                <button id="settings-btn" class="settings-button">Param√®tres</button>
            </div>
            <div class="control-group">
                <span>Son:</span>
                <label class="sound-toggle">
                    <input type="checkbox" id="sound-toggle" checked>
                    <span class="slider"></span>
                </label>
                <span class="animation-toggle">Animations:</span>
                <label class="sound-toggle">
                    <input type="checkbox" id="animation-toggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="theme-selector">
            <div class="theme-option theme-classic-option active" data-theme="classic"></div>
            <div class="theme-option theme-dark-option" data-theme="dark"></div>
            <div class="theme-option theme-nature-option" data-theme="nature"></div>
            <div class="theme-option theme-ocean-option" data-theme="ocean"></div>
            <div class="theme-option theme-space-option" data-theme="space"></div>
        </div>

        <div class="difficulty-selector">
            <div class="difficulty-option active" data-difficulty="easy">Facile</div>
            <div class="difficulty-option" data-difficulty="medium">Moyen</div>
            <div class="difficulty-option" data-difficulty="hard">Difficile</div>
            <div class="difficulty-option" data-difficulty="expert">Expert</div>
            <div class="difficulty-option" data-difficulty="custom">Personnalis√©</div>
        </div>

        <div id="custom-settings" class="custom-settings" style="display: none;">
            <div>
                <label for="custom-rows">Lignes:</label>
                <input type="number" id="custom-rows" min="5" max="30" value="10">
            </div>
            <div>
                <label for="custom-cols">Colonnes:</label>
                <input type="number" id="custom-cols" min="5" max="30" value="10">
            </div>
            <div>
                <label for="custom-mines">Mines:</label>
                <input type="number" id="custom-mines" min="1" max="500" value="15">
            </div>
            <button id="apply-custom-btn" class="settings-button">Appliquer</button>
        </div>

        <div class="stats">
            <div class="stat" id="mines-count">Mines: 10</div>
            <div class="stat" id="flags-count">Drapeaux: 0</div>
            <div class="stat" id="timer">Temps: 0</div>
        </div>

        <div class="board-container">
            <div class="board" id="board"></div>
        </div>

        <div class="tutorial">
            <h3>Comment jouer:</h3>
            <ol>
                <li><strong>Cliquez gauche</strong> pour r√©v√©ler une case.</li>
                <li><strong>Cliquez droit</strong> pour placer/retirer un drapeau.</li>
                <li>Les nombres indiquent combien de mines sont adjacentes √† cette case.</li>
                <li>Le but est de r√©v√©ler toutes les cases sans mines.</li>
                <li>Utilisez les param√®tres pour personnaliser votre exp√©rience de jeu.</li>
            </ol>
        </div>
    </div>

    <div class="footer">
        D√©mineur Premium - Un jeu classique r√©invent√© avec des effets visuels √©poustouflants
    </div>

    <div class="modal" id="win-modal">
        <div class="modal-content">
            <h2>F√©licitations !</h2>
            <p>Vous avez gagn√© en <span id="win-time">0</span> secondes !</p>
            <p>Score: <span id="win-score">0</span></p>
            <button id="win-new-game-btn">Nouvelle partie</button>
        </div>
    </div>

    <div class="modal" id="lose-modal">
        <div class="modal-content">
            <h2>Boom !</h2>
            <p>Vous avez d√©clench√© une mine !</p>
            <p>Temps: <span id="lose-time">0</span> secondes</p>
            <button id="lose-new-game-btn">Nouvelle partie</button>
        </div>
    </div>

    <div class="modal" id="settings-modal">
        <div class="modal-content">
            <h2>Param√®tres</h2>
            <div style="text-align: left; margin-bottom: 20px;">
                <label>
                    <input type="checkbox" id="first-click-safe" checked> Premier clic toujours s√ªr
                </label><br>
                <label>
                    <input type="checkbox" id="auto-reveal" checked> R√©v√©lation automatique des cases vides
                </label><br>
                <label>
                    <input type="checkbox" id="question-marks"> Activer les points d'interrogation
                </label><br>
                <label>
                    <input type="checkbox" id="border-highlight"> Surbrillance des bordures
                </label>
            </div>
            <button id="save-settings-btn">Enregistrer</button>
        </div>
    </div>

    <audio id="click-sound" src="data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU..."></audio>
    <audio id="flag-sound" src="data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU..."></audio>
    <audio id="win-sound" src="data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU..."></audio>
    <audio id="lose-sound" src="data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU..."></audio>
    <audio id="reveal-sound" src="data:audio/wav;base64,UklGRl9vT19XQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YU..."></audio>

    <script>
        // Configuration du jeu
        const config = {
            easy: { rows: 9, cols: 9, mines: 10 },
            medium: { rows: 16, cols: 16, mines: 40 },
            hard: { rows: 16, cols: 30, mines: 99 },
            expert: { rows: 20, cols: 30, mines: 150 },
            custom: { rows: 10, cols: 10, mines: 15 }
        };

        // √âtat du jeu
        let gameState = {
            board: [],
            revealed: [],
            flagged: [],
            mines: [],
            gameOver: false,
            gameWon: false,
            firstClick: true,
            timer: 0,
            timerInterval: null,
            flagsPlaced: 0,
            difficulty: 'easy',
            settings: {
                firstClickSafe: true,
                autoReveal: true,
                questionMarks: false,
                borderHighlight: true,
                soundEnabled: true,
                animationsEnabled: true
            }
        };

        // √âl√©ments du DOM
        const elements = {
            board: document.getElementById('board'),
            minesCount: document.getElementById('mines-count'),
            flagsCount: document.getElementById('flags-count'),
            timer: document.getElementById('timer'),
            winModal: document.getElementById('win-modal'),
            loseModal: document.getElementById('lose-modal'),
            settingsModal: document.getElementById('settings-modal'),
            winTime: document.getElementById('win-time'),
            winScore: document.getElementById('win-score'),
            loseTime: document.getElementById('lose-time'),
            newGameBtn: document.getElementById('new-game-btn'),
            winNewGameBtn: document.getElementById('win-new-game-btn'),
            loseNewGameBtn: document.getElementById('lose-new-game-btn'),
            settingsBtn: document.getElementById('settings-btn'),
            saveSettingsBtn: document.getElementById('save-settings-btn'),
            soundToggle: document.getElementById('sound-toggle'),
            animationToggle: document.getElementById('animation-toggle'),
            firstClickSafe: document.getElementById('first-click-safe'),
            autoReveal: document.getElementById('auto-reveal'),
            questionMarks: document.getElementById('question-marks'),
            borderHighlight: document.getElementById('border-highlight'),
            customSettings: document.getElementById('custom-settings'),
            customRows: document.getElementById('custom-rows'),
            customCols: document.getElementById('custom-cols'),
            customMines: document.getElementById('custom-mines'),
            applyCustomBtn: document.getElementById('apply-custom-btn')
        };

        // Sons (encod√©s en base64 pour un seul fichier)
        const sounds = {
            click: document.getElementById('click-sound'),
            flag: document.getElementById('flag-sound'),
            win: document.getElementById('win-sound'),
            lose: document.getElementById('lose-sound'),
            reveal: document.getElementById('reveal-sound')
        };

        // Initialisation du jeu
        function initGame() {
            // R√©initialiser l'√©tat du jeu
            gameState = {
                ...gameState,
                board: [],
                revealed: [],
                flagged: [],
                mines: [],
                gameOver: false,
                gameWon: false,
                firstClick: true,
                timer: 0,
                flagsPlaced: 0
            };

            // Arr√™ter le timer s'il est en cours
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
                gameState.timerInterval = null;
            }

            // Mettre √† jour l'affichage
            updateStats();
            updateTimer();

            // Cr√©er le plateau
            createBoard();
        }

        // Cr√©er le plateau de jeu
        function createBoard() {
            const { rows, cols } = config[gameState.difficulty];
            
            // D√©finir les variables CSS
            document.documentElement.style.setProperty('--rows', rows);
            document.documentElement.style.setProperty('--cols', cols);
            
            // Vider le plateau
            elements.board.innerHTML = '';
            
            // Initialiser les tableaux d'√©tat
            gameState.board = Array(rows).fill().map(() => Array(cols).fill(0));
            gameState.revealed = Array(rows).fill().map(() => Array(cols).fill(false));
            gameState.flagged = Array(rows).fill().map(() => Array(cols).fill(false));
            
            // Cr√©er les cellules
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    
                    // Gestion des √©v√©nements
                    cell.addEventListener('click', handleCellClick);
                    cell.addEventListener('contextmenu', handleCellRightClick);
                    
                    elements.board.appendChild(cell);
                }
            }
        }

        // Placer les mines apr√®s le premier clic
        function placeMines(firstRow, firstCol) {
            const { rows, cols, mines } = config[gameState.difficulty];
            const totalCells = rows * cols;
            let minesPlaced = 0;
            
            // S'assurer qu'il n'y a pas plus de mines que de cellules
            const safeMines = Math.min(mines, totalCells - 9); // -9 pour la zone s√ªre
            
            // Placer les mines al√©atoirement
            while (minesPlaced < safeMines) {
                const row = Math.floor(Math.random() * rows);
                const col = Math.floor(Math.random() * cols);
                
                // Ne pas placer de mine sur la premi√®re case cliqu√©e ou autour
                if (Math.abs(row - firstRow) <= 1 && Math.abs(col - firstCol) <= 1) {
                    continue;
                }
                
                // Ne pas placer de mine l√† o√π il y en a d√©j√† une
                if (gameState.board[row][col] === -1) {
                    continue;
                }
                
                // Placer la mine
                gameState.board[row][col] = -1;
                gameState.mines.push({ row, col });
                minesPlaced++;
            }
            
            // Calculer les nombres pour les cases adjacentes
            calculateNumbers();
        }

        // Calculer les nombres pour les cases adjacentes aux mines
        function calculateNumbers() {
            const { rows, cols } = config[gameState.difficulty];
            const directions = [
                [-1, -1], [-1, 0], [-1, 1],
                [0, -1],          [0, 1],
                [1, -1],  [1, 0], [1, 1]
            ];
            
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    // Passer les cases qui sont des mines
                    if (gameState.board[row][col] === -1) continue;
                    
                    let count = 0;
                    
                    // V√©rifier les 8 directions
                    for (const [dr, dc] of directions) {
                        const newRow = row + dr;
                        const newCol = col + dc;
                        
                        // V√©rifier les limites
                        if (newRow >= 0 && newRow < rows && newCol >= 0 && newCol < cols) {
                            if (gameState.board[newRow][newCol] === -1) {
                                count++;
                            }
                        }
                    }
                    
                    gameState.board[row][col] = count;
                }
            }
        }

        // G√©rer le clic sur une case
        function handleCellClick(e) {
            if (gameState.gameOver || gameState.gameWon) return;
            
            const row = parseInt(e.target.dataset.row);
            const col = parseInt(e.target.dataset.col);
            
            // Ne rien faire si la case est d√©j√† r√©v√©l√©e ou marqu√©e
            if (gameState.revealed[row][col] || gameState.flagged[row][col]) return;
            
            // Premier clic - placer les mines
            if (gameState.firstClick) {
                startTimer();
                if (gameState.settings.firstClickSafe) {
                    placeMines(row, col);
                } else {
                    placeMines(-2, -2); // Placer les mines sans zone s√ªre
                }
                gameState.firstClick = false;
            }
            
            // Jouer le son
            if (gameState.settings.soundEnabled) {
                sounds.click.currentTime = 0;
                sounds.click.play().catch(e => console.log("Le son n'a pas pu √™tre jou√©:", e));
            }
            
            // Ajouter un effet de ripple
            if (gameState.settings.animationsEnabled) {
                createRippleEffect(e.target, e.clientX, e.clientY);
            }
            
            // R√©v√©ler la case
            revealCell(row, col);
            
            // V√©rifier si le jeu est gagn√©
            checkWin();
        }

        // G√©rer le clic droit sur une case
        function handleCellRightClick(e) {
            e.preventDefault();
            
            if (gameState.gameOver || gameState.gameWon) return;
            
            const row = parseInt(e.target.dataset.row);
            const col = parseInt(e.target.dataset.col);
            
            // Ne rien faire si la case est d√©j√† r√©v√©l√©e
            if (gameState.revealed[row][col]) return;
            
            // Jouer le son
            if (gameState.settings.soundEnabled) {
                sounds.flag.currentTime = 0;
                sounds.flag.play().catch(e => console.log("Le son n'a pas pu √™tre jou√©:", e));
            }
            
            // Basculer le drapeau
            if (gameState.flagged[row][col]) {
                gameState.flagged[row][col] = false;
                e.target.classList.remove('flagged');
                gameState.flagsPlaced--;
            } else {
                gameState.flagged[row][col] = true;
                e.target.classList.add('flagged');
                gameState.flagsPlaced++;
            }
            
            // Mettre √† jour le compteur de drapeaux
            updateStats();
        }

        // R√©v√©ler une case
        function revealCell(row, col) {
            const { rows, cols } = config[gameState.difficulty];
            
            // V√©rifier les limites
            if (row < 0 || row >= rows || col < 0 || col >= cols) return;
            
            // Ne rien faire si la case est d√©j√† r√©v√©l√©e ou marqu√©e
            if (gameState.revealed[row][col] || gameState.flagged[row][col]) return;
            
            // Marquer comme r√©v√©l√©e
            gameState.revealed[row][col] = true;
            
            // R√©cup√©rer l'√©l√©ment DOM
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            cell.classList.add('revealed');
            
            // Si c'est une mine, fin du jeu
            if (gameState.board[row][col] === -1) {
                cell.classList.add('mine', 'exploded');
                gameOver(false);
                return;
            }
            
            // Ajouter la classe du nombre si n√©cessaire
            if (gameState.board[row][col] > 0) {
                cell.classList.add(`number-${gameState.board[row][col]}`);
                cell.textContent = gameState.board[row][col];
                
                // Jouer le son de r√©v√©lation
                if (gameState.settings.soundEnabled) {
                    sounds.reveal.currentTime = 0;
                    sounds.reveal.play().catch(e => console.log("Le son n'a pas pu √™tre jou√©:", e));
                }
            } else {
                // Case vide - r√©v√©ler r√©cursivement les cases adjacentes
                if (gameState.settings.autoReveal) {
                    const directions = [
                        [-1, -1], [-1, 0], [-1, 1],
                        [0, -1],          [0, 1],
                        [1, -1],  [1, 0], [1, 1]
                    ];
                    
                    for (const [dr, dc] of directions) {
                        revealCell(row + dr, col + dc);
                    }
                }
            }
        }

        // V√©rifier si le joueur a gagn√©
        function checkWin() {
            const { rows, cols } = config[gameState.difficulty];
            let unrevealedSafeCells = 0;
            
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    if (!gameState.revealed[row][col] && gameState.board[row][col] !== -1) {
                        unrevealedSafeCells++;
                    }
                }
            }
            
            if (unrevealedSafeCells === 0) {
                gameOver(true);
            }
        }

        // Fin du jeu
        function gameOver(isWin) {
            // Arr√™ter le timer
            clearInterval(gameState.timerInterval);
            gameState.timerInterval = null;
            
            // Marquer la fin du jeu
            gameState.gameOver = true;
            
            if (isWin) {
                gameState.gameWon = true;
                
                // Jouer le son de victoire
                if (gameState.settings.soundEnabled) {
                    sounds.win.currentTime = 0;
                    sounds.win.play().catch(e => console.log("Le son n'a pas pu √™tre jou√©:", e));
                }
                
                // Afficher le modal de victoire
                elements.winTime.textContent = gameState.timer;
                elements.winScore.textContent = calculateScore();
                elements.winModal.style.display = 'flex';
                
                // Lancer les confettis
                if (gameState.settings.animationsEnabled) {
                    createConfetti();
                }
            } else {
                // Jouer le son de d√©faite
                if (gameState.settings.soundEnabled) {
                    sounds.lose.currentTime = 0;
                    sounds.lose.play().catch(e => console.log("Le son n'a pas pu √™tre jou√©:", e));
                }
                
                // Afficher le modal de d√©faite
                elements.loseTime.textContent = gameState.timer;
                elements.loseModal.style.display = 'flex';
                
                // R√©v√©ler toutes les mines
                revealAllMines();
            }
        }

        // R√©v√©ler toutes les mines
        function revealAllMines() {
            const { rows, cols } = config[gameState.difficulty];
            
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < cols; col++) {
                    if (gameState.board[row][col] === -1 && !gameState.revealed[row][col]) {
                        const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                        cell.classList.add('revealed', 'mine');
                    }
                }
            }
        }

        // Calculer le score
        function calculateScore() {
            const { rows, cols, mines } = config[gameState.difficulty];
            const totalCells = rows * cols;
            const percentage = (mines / totalCells) * 100;
            
            // Score bas√© sur le temps et la difficult√©
            let score = Math.floor((10000 / (gameState.timer + 1)) * (percentage / 10));
            
            return score;
        }

        // Mettre √† jour les statistiques
        function updateStats() {
            const { mines } = config[gameState.difficulty];
            elements.minesCount.textContent = `Mines: ${mines}`;
            elements.flagsCount.textContent = `Drapeaux: ${gameState.flagsPlaced}`;
        }

        // D√©marrer le timer
        function startTimer() {
            gameState.timer = 0;
            updateTimer();
            
            gameState.timerInterval = setInterval(() => {
                gameState.timer++;
                updateTimer();
            }, 1000);
        }

        // Mettre √† jour le timer
        function updateTimer() {
            elements.timer.textContent = `Temps: ${gameState.timer}`;
        }

        // Cr√©er un effet de ripple
        function createRippleEffect(element, x, y) {
            const rect = element.getBoundingClientRect();
            const ripple = document.createElement('span');
            ripple.className = 'ripple';
            
            ripple.style.left = `${x - rect.left}px`;
            ripple.style.top = `${y - rect.top}px`;
            
            element.appendChild(ripple);
            
            ripple.addEventListener('animationend', () => {
                ripple.remove();
            });
        }

        // Cr√©er des confettis
        function createConfetti() {
            const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4CAF50', '#8BC34A', '#CDDC39', '#FFEB3B', '#FFC107', '#FF9800', '#FF5722'];
            
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                
                // Position al√©atoire
                const x = Math.random() * window.innerWidth;
                const delay = Math.random() * 5;
                const duration = 3 + Math.random() * 4;
                
                // Couleur al√©atoire
                const color = colors[Math.floor(Math.random() * colors.length)];
                
                // Taille al√©atoire
                const size = 5 + Math.random() * 10;
                
                // Appliquer les styles
                confetti.style.left = `${x}px`;
                confetti.style.backgroundColor = color;
                confetti.style.width = `${size}px`;
                confetti.style.height = `${size}px`;
                confetti.style.animationDelay = `${delay}s`;
                confetti.style.animationDuration = `${duration}s`;
                
                document.body.appendChild(confetti);
                
                // Supprimer apr√®s l'animation
                setTimeout(() => {
                    confetti.remove();
                }, (delay + duration) * 1000);
            }
        }

        // Gestion des √©v√©nements
        function setupEventListeners() {
            // Nouvelle partie
            elements.newGameBtn.addEventListener('click', initGame);
            elements.winNewGameBtn.addEventListener('click', () => {
                elements.winModal.style.display = 'none';
                initGame();
            });
            elements.loseNewGameBtn.addEventListener('click', () => {
                elements.loseModal.style.display = 'none';
                initGame();
            });
            
            // Param√®tres
            elements.settingsBtn.addEventListener('click', () => {
                elements.settingsModal.style.display = 'flex';
            });
            elements.saveSettingsBtn.addEventListener('click', () => {
                gameState.settings = {
                    ...gameState.settings,
                    firstClickSafe: elements.firstClickSafe.checked,
                    autoReveal: elements.autoReveal.checked,
                    questionMarks: elements.questionMarks.checked,
                    borderHighlight: elements.borderHighlight.checked
                };
                elements.settingsModal.style.display = 'none';
            });
            
            // Sons et animations
            elements.soundToggle.addEventListener('change', (e) => {
                gameState.settings.soundEnabled = e.target.checked;
            });
            elements.animationToggle.addEventListener('change', (e) => {
                gameState.settings.animationsEnabled = e.target.checked;
            });
            
            // Th√®mes
            document.querySelectorAll('.theme-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelector('.theme-option.active').classList.remove('active');
                    option.classList.add('active');
                    document.body.className = `theme-${option.dataset.theme}`;
                });
            });
            
            // Difficult√©
            document.querySelectorAll('.difficulty-option').forEach(option => {
                option.addEventListener('click', () => {
                    document.querySelector('.difficulty-option.active').classList.remove('active');
                    option.classList.add('active');
                    gameState.difficulty = option.dataset.difficulty;
                    
                    // Afficher/masquer les param√®tres personnalis√©s
                    if (gameState.difficulty === 'custom') {
                        elements.customSettings.style.display = 'flex';
                    } else {
                        elements.customSettings.style.display = 'none';
                        initGame();
                    }
                });
            });
            
            // Appliquer les param√®tres personnalis√©s
            elements.applyCustomBtn.addEventListener('click', () => {
                const rows = parseInt(elements.customRows.value);
                const cols = parseInt(elements.customCols.value);
                const mines = parseInt(elements.customMines.value);
                
                // Validation
                if (rows < 5 || rows > 30 || cols < 5 || cols > 30 || mines < 1 || mines > rows * cols - 9) {
                    alert('Param√®tres invalides. Les mines doivent √™tre moins nombreuses que les cases (avec une zone s√ªre de 3x3).');
                    return;
                }
                
                config.custom = { rows, cols, mines };
                initGame();
            });
        }

        // Initialiser le jeu au chargement
        window.addEventListener('load', () => {
            setupEventListeners();
            initGame();
        });
    </script>
</body>
</html>